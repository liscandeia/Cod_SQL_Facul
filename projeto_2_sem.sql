/*
Criar a primeira dabela baseada no MER apresentado.
Por qual a tabela que devemos iniciar?
Onde encontrar referências?
O que fazer quando tiver dúvidas ou aparecer um erro?
*/ 

drop table TB_PAIS;

-- Criar tabela - 
create table TB_PAIS (  
  id_pais number not null,
  nm_pais varchar2 (50) not null,  
  nr_populacao number,
  constraint pk_pais primary key (id_pais)  
);

-- Inserir dados na tabela
insert into TB_PAIS values (101, 'Italia', null);
insert into TB_PAIS (id_pais, nm_pais) values (102, 'Alemanha');
insert into TB_PAIS (id_pais, nm_pais, nr_populacao) values (103, 'Inglaterra', 12000000);

--  Consultar dados na tabela
select * from TB_PAIS;


/*A tabela EQUIPE deverá se relacionar com a tabela PAIS*/

drop table TB_EQUIPE;

create table TB_EQUIPE (  
 id_equipe number not null primary key,
 nm_equipe varchar2 (50) not null,  
 id_pais number not null, 
 constraint fk_equipe_pais foreign key (id_pais) references TB_PAIS (id_pais) 
);

insert into TB_EQUIPE values (501, 'Ferrari', 101);
insert into TB_EQUIPE values (502, 'Mercedes-Benz', 102);
insert into TB_EQUIPE values (503, 'McLaren', 103);
insert into TB_EQUIPE values (504, 'Williams', 103);
insert into TB_EQUIPE values (505, 'Red Bull', 103);

select * from TB_EQUIPE;


/*A tabela PILOTO deverá se relacionar com a tabela PAIS e EQUIPE*/

drop table TB_PILOTO;

create table TB_PILOTO (
 id_piloto number GENERATED BY DEFAULT ON NULL AS IDENTITY,
 nm_piloto VARCHAR2(50),
 dt_nascimento DATE,
 id_pais number not null, 
 id_equipe number not null,
 constraint fk_piloto_pais foreign key (id_pais) references TB_PAIS (id_pais),
 constraint fk_piloto_equipe foreign key (id_equipe) references TB_EQUIPE (id_equipe)
);


insert into TB_PILOTO (nm_piloto,dt_nascimento,id_pais,id_equipe) 
            values ('Marianne Bird', TO_DATE('15/04/1986', 'DD/MM/YYYY'), 102, 501);
insert into TB_PILOTO (nm_piloto,dt_nascimento,id_pais,id_equipe) 
            values ('Giada Daniele', TO_DATE('13/08/1990', 'DD/MM/YYYY'), 101, 502);
insert into TB_PILOTO (nm_piloto,dt_nascimento,id_pais,id_equipe) 
            values ('Darragh Price', TO_DATE('01/02/1990', 'DD/MM/YYYY'), 103, 502);
insert into TB_PILOTO (nm_piloto,dt_nascimento,id_pais,id_equipe) 
            values ('Claire Naoise', TO_DATE('12/12/1989', 'DD/MM/YYYY'), 103, 503);

select * from TB_PILOTO;


/*Criar uma query apresentanto os pilotos por equipe*/
select tp.nm_pais,nm_piloto from TB_PAIS tp 
    join TB_PILOTO plt on plt.id_pais = tp.id_pais


/*Criar uma query que exibe a quantidade de pilotos por ano de nascimento, 
ordenando-os por este aspecto de forma ascendente – do ano mais antigo ao mais recente*/

--Saber a quantidade de pilotos por país
select tp.nm_pais, count(nm_piloto) from TB_PAIS tp 
    join TB_PILOTO plt on plt.id_pais = tp.id_pais
    group by tp.nm_pais;

select extract(year from dt_nascimento) from tb_piloto
    order by dt_nascimento asc; 
   

/*Criar uma query que exibe o nome do piloto, o país de nascimento, nome da equipe, 
país da equipe, colocação final, nome do circuito e a data da realização da prova*/

select 
    plt.nm_piloto, 
    plt.id_pais,
    eqp.nm_equipe, 
    eqp.id_pais
from TB_PILOTO plt  
    left join TB_EQUIPE eqp 
        on eqp.id_equipe = plt.id_equipe
    join TB_PAIS tp 
        on tp.id_pais = eqp.id_pais